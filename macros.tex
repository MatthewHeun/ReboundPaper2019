% The next command tells RStudio to do "Compile PDF" on book.Rnw,
% instead of this chapter, thereby eliminating the need to switch back to book.Rnw 
% before making the book.
%!TEX root = HSB.Rnw


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This file contains macros for
% Heun, Semieniuk, Brockway, 
% A Comprehensive Analytical Framework for Energy Rebound. 
% It is incorporated into the main file by the command
% \input{macros.tex}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% Decorations for symbols

\newcommand{\rate}[1]{\dot{#1}}                    % Rate of a quantity

% Create "after" commands
\newcommand{\orig}[1]{#1}
\newcommand{\adev}[1]{{#1}^\prime}
\newcommand{\alc}[1]{{#1}^*}
\newcommand{\asub}[1]{\hat{#1}}
\newcommand{\ainc}[1]{\bar{#1}}
\newcommand{\aprod}[1]{\tilde{#1}}

% Create the "before" commands
\newcommand{\bdev}[1]{\orig{#1}}
\newcommand{\blc}[1]{\adev{#1}}
\newcommand{\bsub}[1]{\alc{#1}}
\newcommand{\binc}[1]{\asub{#1}}
\newcommand{\bprod}[1]{\ainc{#1}}

% Decoration combinations
% Rates after
\newcommand{\rorig}[1]{\orig{\rate{#1}}}
\newcommand{\radev}[1]{\adev{\rate{#1}}}
\newcommand{\ralc}[1]{\alc{\rate{#1}}}
\newcommand{\rasub}[1]{\asub{\rate{#1}}}
\newcommand{\rainc}[1]{\ainc{\rate{#1}}}
\newcommand{\raprod}[1]{\aprod{\rate{#1}}}

% Rates before
\newcommand{\rbdev}[1]{\rorig{#1}}
\newcommand{\rblc}[1]{\radev{#1}}
\newcommand{\rbsub}[1]{\ralc{#1}}
\newcommand{\rbinc}[1]{\rasub{#1}}
\newcommand{\rbprod}[1]{\rainc{#1}}

%%%%% Subscript spacing

\newcommand{\life}{li\!f\!e}
\newcommand{\OM}{O\!M}
\newcommand{\OMd}{O\!M\!d}
\newcommand{\productivity}{pr\!od}


%%%%% Convenient symbols

\newcommand{\Sdot}{\rate{S}_{dev}}


%%%%% Colors

\newcommand{\devcolor}{red!25!white}
\newcommand{\lccolor}{orange!25!white}
\newcommand{\subcolor}{yellow!25!white}
\newcommand{\inccolor}{green!25!white}
\newcommand{\prodcolor}{blue!25!white}


%%%%% Coloration of text background

%
% Inline color box around text
% Arguments:
%   [#1]: background color for the box
%   {#2}: text inside the box
%
\newtcbox{\inlinebox}[1][]{on line, 
colback=#1,
colframe=#1,
before upper={\rule[-2pt]{0pt}{10pt}},
boxrule=1pt,
boxsep=0pt,
left=3pt,
right=3pt,
top=2pt,
bottom=2pt}


%%%%% Colored phrases

% Device effect
\newcommand{\deveffect}{\inlinebox[\devcolor]{device effect}}
\newcommand{\Deveffect}{\inlinebox[\devcolor]{Device effect}}
\newcommand{\DevEffect}{\inlinebox[\devcolor]{Device Effect}}

% Life cycle effect
\newcommand{\lceffect}{\inlinebox[\lccolor]{life cycle effect}}
\newcommand{\Lceffect}{\inlinebox[\lccolor]{Life cycle effect}}
\newcommand{\LcEffect}{\inlinebox[\lccolor]{Life cycle Effect}}

% Substitution effect
\newcommand{\subeffect}{\inlinebox[\subcolor]{substitution effect}}
\newcommand{\Subeffect}{\inlinebox[\subcolor]{Substitution effect}}
\newcommand{\SubEffect}{\inlinebox[\subcolor]{Substitution Effect}}

% Income effect
\newcommand{\inceffect}{\inlinebox[\inccolor]{income effect}}
\newcommand{\Inceffect}{\inlinebox[\inccolor]{Income effect}}
\newcommand{\IncEffect}{\inlinebox[\inccolor]{Income Effect}}

% Productivity effect
\newcommand{\prodeffect}{\inlinebox[\prodcolor]{productivity effect}}
\newcommand{\Prodeffect}{\inlinebox[\prodcolor]{Productivity effect}}
\newcommand{\ProdEffect}{\inlinebox[\prodcolor]{Productivity Effect}}



%%%%% minipage for assumptions and constraints tables
% Arguments:
%   #1: Width (multiple of \linewidth
%   #2: text inside the minipage
%
\newcommand{\mptable}[2]{\begin{minipage}{#1\linewidth} \useshortskip{} \begin{equation} #2 \end{equation} \end{minipage}}



%%%%% Oft-used references

\newcommand{\Ba}[1]{\citeauthor[#1]{Borenstein:2015aa}}
\newcommand{\Bapp}[1]{\citeauthor[#1]{Borenstein:2015aa}'s \citeyearpar{Borenstein:2015aa}}
\newcommand{\Bp}[1]{\citep[#1]{Borenstein:2015aa}}
\newcommand{\Bt}[1]{\citet[#1]{Borenstein:2015aa}}

\newcommand{\Ta}[1]{\citeauthor[#1]{Thomas:2013aa}}
\newcommand{\Tapp}[1]{\citeauthor[#1]{Thomas:2013aa}'s \citeyearpar{Thomas:2013aa}}
\newcommand{\Tp}[1]{\citep[#1]{Thomas:2013aa, Thomas:2013ab}}
\newcommand{\Tpone}[1]{\citep[#1]{Thomas:2013aa}}
\newcommand{\Tptwo}[1]{\citep[#1]{Thomas:2013ab}}
\newcommand{\Tt}[1]{\citet[#1]{Thomas:2013aa, Thomas:2013ab}}
\newcommand{\Ttone}[1]{\citet[#1]{Thomas:2013aa}}
\newcommand{\Tttwo}[1]{\citet[#1]{Thomas:2013ab}}


%%%%% Derivation pages

% Column widths
\newcommand{\derivtextsize}{\footnotesize}
\newcommand{\derivpageleftcolwidth}{0.11\textwidth}
\newcommand{\derivpageenergycolwidth}{0.7\textwidth}
\newcommand{\derivpagefinancialcolwidth}{0.7\textwidth}

% Horizontal rule between sections of derivations

\newcommand{\sectionsep}{\noindent\rule{1.6\textwidth}{0.4pt}}


%
% Derivation section
% Arguments:
%   #1: accounting stage (original, prime, etc.)
%   #2: energy column
%   #3: financial column
%
\newcommand{\derivsection}[3]{%

\derivtextsize{}

\begin{minipage}[t]{\derivpageleftcolwidth}
~\\#1
\end{minipage}
%
%
%
\begin{minipage}[t]{\derivpageenergycolwidth}
#2
\end{minipage}
%
~
%
\begin{minipage}[t]{\derivpagefinancialcolwidth}
#3
\end{minipage}

\normalsize{}

}


%
% Derivation page header
% Arguments:
%   #1: Effect type header text (e.g., Device Effect)
%
\newcommand{\derivheader}[1]{

\begin{center}
  #1
\end{center}

\derivsection{}
{\begin{center}\emph{Energy analysis}\end{center}}
{\begin{center}\emph{Financial analysis}\end{center}}

}




% Equations

% Original
\newcommand{\Eacctorig}{\rbdev{E} = \rbdev{E}_s + \rbdev{E}_{emb} + (\rbdev{C}_{\OMd} + \rbdev{C}_o) I_E}
\newcommand{\Macctorig}{\rbdev{M} = p_E \rbdev{E}_s + \rbdev{C}_{cap} + \rbdev{C}_{\OMd} + \rbdev{C}_o + \rbdev{N}}

% Before device effect (save as original)
\newcommand{\Eacctbdev}{\Eacctorig}
\newcommand{\Macctbdev}{\Macctorig}

% After device effect
\newcommand{\Eacctadev}{\radev{E} = \radev{E}_s + \radev{E}_{emb} + (\radev{C}_{\OMd} + \radev{C}_o) I_E}
\newcommand{\Macctadev}{\radev{M} = p_E \radev{E}_s + \radev{C}_{cap} + \radev{C}_{\OMd} + \radev{C}_o + \radev{N}}

% Before life cycle effect (same as after device effect)
\newcommand{\Eacctblc}{\Eacctadev}
\newcommand{\Macctblc}{\Macctadev}

% After life cycle effect
\newcommand{\Eacctalc}{\ralc{E} = \ralc{E}_s + \ralc{E}_{emb} + (\ralc{C}_{\OMd} + \ralc{C}_o) I_E}
\newcommand{\Macctalc}{\ralc{M} = p_E \ralc{E}_s + \ralc{C}_{cap} + \ralc{C}_{\OMd} + \ralc{C}_o + \ralc{N}}

% Before substitution effect (same as after life cycle effect)
\newcommand{\Eacctbsub}{\Eacctalc}
\newcommand{\Macctbsub}{\Macctalc}

% After substitution effect
\newcommand{\Eacctasub}{\rasub{E} = \rasub{E}_s + \rasub{E}_{emb} + (\rasub{C}_{\OMd} + \rasub{C}_o) I_E}
\newcommand{\Macctasub}{\rasub{M} = p_E \rasub{E}_s + \rasub{C}_{cap} + \rasub{C}_{\OMd} + \rasub{C}_o + \rasub{N}}

% Before income effect (same as after substitution effect)
\newcommand{\Eacctbinc}{\Eacctasub}
\newcommand{\Macctbinc}{\Macctasub}

% After income effect
\newcommand{\Eacctainc}{\rainc{E} = \rainc{E}_s + \rainc{E}_{emb} + (\rainc{C}_{\OMd} + \rainc{C}_o) I_E}
\newcommand{\Macctainc}{\rainc{M} = p_E \rainc{E}_s + \rainc{C}_{cap} + \rainc{C}_{\OMd} + \rainc{C}_o + \rainc{N}}

% Embodied energy rebound
\newcommand{\Reembequation}{\frac{\left( \frac{\alc{E}_{emb}}{\blc{E}_{emb}}
  \frac{\blc{t}}{\alc{t}} - 1 \right) \rblc{E}_{emb}}{\Sdot}}

% Equation for S_dot_dev
\newcommand{\Sdoteqn}{\left( \frac{\aprod{\eta}}{\bdev{\eta}} - 1 \right)\!\frac{\bdev{\eta}}{\aprod{\eta}} \rbdev{E}_s}

% Equation for Re_dsub
\newcommand{\Redsubeqn}{\frac{\left( \frac{\aprod{\eta}}{\bdev{\eta}} \right)^{-\epsilon_{p_s}} - 1}
                        {\frac{\aprod{\eta}}{\bdev{\eta}} - 1}}
                        
% Equation for Re_isub
\newcommand{\Reisubeqn}{\frac{{\left( \frac{\aprod{\eta}}{\bdev{\eta}}  \right)}
                          ^{\epsilon_{p_s} (\alpha / \beta)} - 1}{\frac{\aprod{\eta}}{\bdev{\eta}} - 1} \; 
                          \frac{\aprod{\eta}}{\bdev{\eta}} \; 
                          \frac{\rbdev{C}_o I_E}{\rbdev{E}_s}}

% Equation for Re_dinc
\newcommand{\Redinceqn}{\frac{\left[ \left( 1 + \frac{\rbinc{N}}{\rbdev{M}} \right) ^{\epsilon_{dinc}} - 1  \right] 
                  \left( \frac{\aprod{\eta}}{\bdev{\eta}} \right)^{-\epsilon_{p_s}}}
              {\left( \frac{\aprod{\eta}}{\bdev{\eta}} - 1 \right)}}

% Equation for Re_iinc
\newcommand{\Reiinceqn}{p_E I_E - Re_{cap} - Re_{\OMd} - p_E I_E Re_{dsub} - Re_{isub} - p_E I_E Re_{dinc}}

% Equation for Re_prod
\newcommand{\Reprodeqn}{k p_E I_E - k Re_{cap} - k Re_{\OMd} - k p_E I_E Re_{dsub} - k Re_{isub}}
